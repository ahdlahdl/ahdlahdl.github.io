<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"/>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<style type="text/css">
.viewer {}

.top_menu {margin-bottom:5px;}
.category_menu {float:left;}
.total_search {margin-left:10px;margin-right:10px;float:left;}
.total_search .url {margin-left:10px;width:200px;float:left;}

.channel {float:left;/*min-width:300px;width:30%;*/width:350px;margin-right:1px;}
.channel .url {width:250px;float:left;}
.channel iframe {border-width:1px;width:100%;height:100%;min-height:450px;}
</style>
</head>
<body>
<div class="container-fluid">
	<div class="top_menu">
		<div class="category_menu"></div>

		<div class="total_search">
			<input class="form-control url" type="text"/><a class="btn btn-success search" href="#">검색</a>
		</div>
		
		<div class="tools">
			<a class="btn btn-primary geturl" href="#">URL 생성</a>
		</div>
	</div>
	
    <div class="viewer">
    	<div class="channel" id="frm1" style="display:none;">
			<input class="form-control url" type="text"/><a class="btn btn-success search" href="#">↙</a>
			<a class="btn btn-warning btn-sm narrow" href="#">-</a><a class="btn btn-warning btn-sm wide" href="#">+</a>
	        <iframe src="blank.html" target="_blank"></iframe>
    	</div>

    	<div class="channel" id="frm2" style="display:none;">
			<input class="form-control url" type="text"/><a class="btn btn-success search" href="#">↙</a>
			<a class="btn btn-warning btn-sm narrow" href="#">-</a><a class="btn btn-warning btn-sm wide" href="#">+</a>
	        <iframe src="blank.html"></iframe>
    	</div>

    	<div class="channel" id="frm3" style="display:none;">
			<input class="form-control url" type="text"/><a class="btn btn-success search" href="#">↙</a>
			<a class="btn btn-warning btn-sm narrow" href="#">-</a><a class="btn btn-warning btn-sm wide" href="#">+</a>
	        <iframe src="blank.html"></iframe>
    	</div>
    	
    	<div class="channel" id="frm4" style="display:none;">
			<input class="form-control url" type="text"/><a class="btn btn-success search" href="#">↙</a>
			<a class="btn btn-warning btn-sm narrow" href="#">-</a><a class="btn btn-warning btn-sm wide" href="#">+</a>
	        <iframe src="blank.html"></iframe>
    	</div>
    	
    	<div class="channel" id="frm5" style="display:none;">
			<input class="form-control url" type="text"/><a class="btn btn-success search" href="#">↙</a>
			<a class="btn btn-warning btn-sm narrow" href="#">-</a><a class="btn btn-warning btn-sm wide" href="#">+</a>
	        <iframe src="blank.html"></iframe>
    	</div>
    </div>
</div>
<script type="text/javascript">
var Url = function(name, url) {
	this.name = name;
	this.url = url;
}

var aSiteMapList = [
	{name:"포털",list:[new Url("네이버", "http://m.naver.com"), new Url("다음", "http://m.daum.net"), new Url("네이트", "http://m.nate.com")]},
	{name:"웹툰",list:[new Url("네이버 웹툰", "http://m.comic.naver.com/"), new Url("다음 웹툰", "http://m.webtoon.daum.net"), new Url("네이트 웹툰", "http://m.comics.nate.com")]},
	//{name:"쇼핑",list:["http://m.gmarket.com", "http://mobile.auction.co.kr/", "blank.html"]},
	{name:"소셜커머스",list:[new Url("쿠팡", "http://m.coupang.com/nm/"), new Url("티몬", "http://m.ticketmonster.co.kr"), new Url("위메프", "http://m.wemakeprice.com")]}
];

var UrlBox = function(htOption) {
	var that = this;
	var welContainer, welUrlBox, welBtnSearch;
	
	var init = function() {
		welContainer = $(htOption.container);
		welUrlBox = welContainer.find("input.url");
		welBtnSearch = welContainer.find(".btn.search");
		
		welBtnSearch.bind("click", function(we) {
			we.preventDefault();
			search();
		});
		
		welUrlBox.keypress(function(e) {
			if (e.keyCode == 13) {
				search();
			}
		});
	}
	
	this.change = function(sUrl) {
		welUrlBox.val(sUrl);
		search();
	}
	
	var search = function() {
		htOption.search(welUrlBox.val());
	}
	
	this.getInfo = function() {
		return welUrlBox.val();
	}
	
	init();
}

/**
 * htOption.container
 * htOption.onResize
 */
var Channel = function(_htOption) {
	var that = this;
	var welContainer, urlBox, welIframe;
	var welBtnNarrow, welBtnWide;

	var htOption = {
			container : null,
			onResize : function() {}
	};

	var MIN_WIDTH = 350;
	
	var init = function() {
		htOption = _htOption;
		welContainer = $(htOption.container);
		urlBox = new UrlBox({
			container : welContainer,
			search : function(sUrl) {
				welIframe.attr("src", sUrl);
			}
		});
		welIframe = welContainer.find("iframe");
		welBtnNarrow = welContainer.find(".narrow");
		welBtnWide = welContainer.find(".wide");
		
		welBtnNarrow.bind("click", function(we) {
			we.preventDefault();
			var width = Math.max(welContainer.width() - 50, MIN_WIDTH);
			welContainer.width(width);
			htOption.onResize();
		});
		
		welBtnWide.bind("click", function(we) {
			we.preventDefault();
			var width = welContainer.width() + 50;
			welContainer.width(width);
			htOption.onResize();
		})
	}
	
	this.search = function(sUrl) {
		urlBox.change(sUrl);
	}
	
	this.show = function(htChannelInfo) {
		welContainer.show();
		if (htChannelInfo.url) {
			that.search(htChannelInfo.url);
		}
		if (htChannelInfo.width) {
			welContainer.width(htChannelInfo.width);
		}
	}
	
	this.hide = function() {
		welContainer.hide();
	}
	
	this.close = function() {
		welContainer.hide();
		welIframe.attr("src", "blank.html");
	}
	
	this.getInfo = function() {
		return {
				url : urlBox.getInfo(),
				width : welContainer.is(":visible") ? welContainer.width() : 0
		};
		return htResult;
	}
	
	init();
}

var viewer = new (function() {
	var that = this;
	var aChannel = [];
	var welChannelList;
	
	this.init = function(_welChannelList) {
		welChannelList = _welChannelList;
		for (var i = 0; i < welChannelList.length; i++) {
			aChannel.push(new Channel({
				container : welChannelList.eq(i),
				onResize : resizeWidth
			}));
		}
		
		drawMenu();
	}
	
	this.changeCategory = function(aSite) {
		for (var i = 0; i < aChannel.length; i++) {
			aChannel[i].close();
		}
		for (var i = 0; i < aSite.length; i++) {
			aChannel[i].show(aSite[i]);
		}
		resizeWidth();
	}
	
	var resizeWidth = function() {
		var totalWidth = 0;
		for (var i = 0; i < aChannel.length; i++) {
			totalWidth += aChannel[i].getInfo().width + 2;
		}
		$(".viewer").width(totalWidth);
	}
	
	var drawMenu = function() {
		var welCategoryMenu = $(".category_menu");
		welCategoryMenu.html("");
		for (var i = 0; i < aSiteMapList.length; i++) {
			var htData = aSiteMapList[i];
			var welButton = $("<a class='btn btn-info menu' href='#'>" + htData.name + "</a>");
			var makeFunction = function(htSiteMap) {
				return function(we) {
					we.preventDefault();
					that.changeCategory(htSiteMap.list);
				}
			}
			welButton.bind("click", makeFunction(htData));
			welCategoryMenu.append(welButton);
		}
	}
	
	this.getInfo = function() {
		var htResult = {
				list : []
		};
		for (var i = 0; i < aChannel.length; i++) {
			var htInfo = aChannel[i].getInfo();
			if (!htInfo.url || htInfo.url == "blank.html") {
				continue;
			}
			htResult.list.push(htInfo);
		}
		return htResult;
	}
	
	this.setInfo = function(htInfo) {
		that.changeCategory(htInfo.list);
	}
})();


$(document).ready(function() {
	viewer.init($(".channel"));
	
	var hash = location.hash.replace(/^#/, "");
	var htInfo = {};
	if (hash && $.trim(hash).length > 0) {
		htInfo = JSON.parse(hash);
	}
	
	if (htInfo.list && htInfo.list.length > 0) {
		viewer.changeCategory(htInfo.list);
	} else {
		viewer.changeCategory(aSiteMapList[0].list);
	}

	resizeIframes();
	
	var totalSearchBox = new UrlBox({
		container : $(".total_search"),
		search : function(keyword) {
			viewer.changeCategory([
			                       new Url("네이버", "http://m.search.naver.com/search.naver?query=" + keyword),
			                       new Url("다음", "https://m.search.daum.net/search?q=" + keyword),
			                       new Url("네이트", "https://m.search.daum.net/nate?w=tot&thr=mnms&q=" + keyword)
		    ]);
		}
	});
	
	$(".geturl").click(function(we) {
		we.preventDefault();
		location.hash = JSON.stringify(viewer.getInfo());
	});
});

function resizeIframes() {
	var win = $(this);
    var awelIframe = $(".channel iframe");
    awelIframe.each(function() {
    	$(this).height(win.height() - 100);
    });
}

$(window).on('resize', resizeIframes);

if (console) {
	console.log = function() {};
	console.error = function() {};
}



</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87941781-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
